//! –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä —Å–∂–∞—Ç–∏—è —Ç–µ–∫—Å—Ç–∞
//!
//! –î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç, —á—Ç–æ –¥–ª—è —Å–∂–∞—Ç–∏—è —Ç–µ–∫—Å—Ç–∞ –ù–ï –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
//! –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ–¥–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ—Ç –∂–µ CompressionConfig.

use longcodezip::{
    CompressionConfig, LongCodeZip, ProviderConfig,
    text_chunker::TextChunkingStrategy,
};

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    env_logger::init();

    // –û–±—ã—á–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è - –ù–ò–ß–ï–ì–û –æ—Å–æ–±–µ–Ω–Ω–æ–≥–æ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –Ω–µ –Ω—É–∂–Ω–æ!
    // –ü–æ–ª–µ `language` –±—É–¥–µ—Ç –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–æ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ compress_text()
    let config = CompressionConfig::default()
        .with_rate(0.4)  // 40% –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
        .with_provider(ProviderConfig::deepseek("sk-b78ab15d637749a9a8c6ae69a919c0a9"));

    let compressor = LongCodeZip::new(config)?;

    let article = r#"
–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç: –í–≤–µ–¥–µ–Ω–∏–µ

–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç (–ò–ò) - —ç—Ç–æ –æ–±–ª–∞—Å—Ç—å –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö –Ω–∞—É–∫, –∑–∞–Ω–∏–º–∞—é—â–∞—è—Å—è —Å–æ–∑–¥–∞–Ω–∏–µ–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω.

–ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≤–∏—Ç–∏—è

–ò–ò –Ω–∞—á–∞–ª—Å—è –≤ 1950-—Ö –≥–æ–¥–∞—Ö —Å —Ä–∞–±–æ—Ç –ê–ª–∞–Ω–∞ –¢—å—é—Ä–∏–Ω–≥–∞. –û–Ω –ø—Ä–µ–¥–ª–æ–∂–∏–ª —Ç–µ—Å—Ç –¢—å—é—Ä–∏–Ω–≥–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ –º–∞—à–∏–Ω.

–í 1956 –≥–æ–¥—É –Ω–∞ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏ –≤ –î–∞—Ä—Ç–º—É—Ç–µ —Ç–µ—Ä–º–∏–Ω "–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç" –±—ã–ª –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –≤–≤–µ–¥–µ–Ω. –≠—Ç–æ —Å–æ–±—ã—Ç–∏–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ä–æ–∂–¥–µ–Ω–∏–µ–º –ò–ò –∫–∞–∫ –Ω–∞—É—á–Ω–æ–π –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã.

–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã

–°–µ–≥–æ–¥–Ω—è –ò–ò –≤–∫–ª—é—á–∞–µ—Ç –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ, –≥–ª—É–±–æ–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ –∏ –Ω–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–µ—Ç–∏. –≠—Ç–∏ –º–µ—Ç–æ–¥—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –∫–æ–º–ø—å—é—Ç–µ—Ä–∞–º —É—á–∏—Ç—å—Å—è –Ω–∞ –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ —è–≤–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.

–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –º–∏—Ä–µ

–ò–ò –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –º–µ–¥–∏—Ü–∏–Ω–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏, –≤ –∞–≤—Ç–æ–º–æ–±–∏–ª—è—Ö –¥–ª—è –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–≥–æ –≤–æ–∂–¥–µ–Ω–∏—è, –≤ —Ñ–∏–Ω–∞–Ω—Å–∞—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–∏—Å–∫–æ–≤.
"#;

    println!("=== –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä —Å–∂–∞—Ç–∏—è —Ç–µ–∫—Å—Ç–∞ ===\n");
    println!("üìù –ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç: {} —Å–∏–º–≤–æ–ª–æ–≤\n", article.len());

    // –°–∂–∏–º–∞–µ–º —Ç–µ–∫—Å—Ç - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—é "–ø–æ –∞–±–∑–∞—Ü–∞–º"
    let result = compressor
        .compress_text(
            article,
            "–ö–æ–≥–¥–∞ –ø–æ—è–≤–∏–ª—Å—è —Ç–µ—Ä–º–∏–Ω –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç?",
            "",
            TextChunkingStrategy::Paragraphs,
        )
        .await?;

    println!("‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∂–∞—Ç–∏—è:\n");
    println!("   –û—Ä–∏–≥–∏–Ω–∞–ª:  {} —Ç–æ–∫–µ–Ω–æ–≤", result.original_tokens);
    println!("   –°–∂–∞—Ç—ã–π:    {} —Ç–æ–∫–µ–Ω–æ–≤", result.compressed_tokens);
    println!("   –ü—Ä–æ—Ü–µ–Ω—Ç:   {:.1}%", result.compression_ratio * 100.0);
    println!();
    println!("{}", "=".repeat(60));
    println!("–°–∂–∞—Ç—ã–π —Ç–µ–∫—Å—Ç:");
    println!("{}", "=".repeat(60));
    println!("{}", result.compressed_code);
    println!("{}", "=".repeat(60));

    println!("\nüí° –í–∞–∂–Ω–æ: –î–ª—è —Ç–µ–∫—Å—Ç–∞ –ù–ï –Ω—É–∂–Ω–æ –Ω–∏—á–µ–≥–æ –º–µ–Ω—è—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥–µ!");
    println!("   –ü–æ–ª–µ `language` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è –¥–ª—è compress_text()");

    Ok(())
}
